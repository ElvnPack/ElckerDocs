---
title: 数据交互
date: 2021-06-22 00:39:10
permalink: /pages/0e7d2e/
categories:
  - 文档中心
  - EAdmin
tags:
  -
---

## mock

环境配置参数： VITE_USE_MOCK

mock 的开启由该参数与环境配合启用：

开发环境下启用本地 mock 禁用线上 mock;

测试环境下禁用本地 mock 并禁用线上 mock;

生产环境下禁用本地 mock 并启用线上 mock

注意：最终的结果以 VITE_USE_MOCK 配置为主导。

### 新增 mock 接口

本地 mock 采用 Node.js 中间件进行参数拦截，

```nodejs
import { MockMethod } from 'vite-plugin-mock';

// const demo ={
//     // 请求地址
//     url: string;
//     // 请求方式
//     method?: MethodType;
//     // 设置超时时间
//     timeout?: number;
//     // 状态吗
//     statusCode?:number;
//     // 响应数据（JSON）
//     response?: ((opt: { [key: string]: string; body: Record<string,any>; query:  Record<string,any>, headers: Record<string, any>; }) => any) | any;
//     // 响应（非JSON）
//     rawResponse?: (req: IncomingMessage, res: ServerResponse) => void;
//   }

export default [
  {
    url: '/api/get',
    method: 'get',
    response: () => {
      return {
        code: 0,
        data: {
          name: 'vben',
        },
      };
    },
  },
  {
    url: '/api/post',
    method: 'post',
    timeout: 2000,
    response: {
      code: 0,
      data: {
        name: 'vben',
      },
    },
  },
  {
    url: '/api/text',
    method: 'post',
    rawResponse: async (req, res) => {
      let reqbody = '';
      await new Promise((resolve) => {
        req.on('data', (chunk) => {
          reqbody += chunk;
        });
        req.on('end', () => resolve(undefined));
      });
      res.setHeader('Content-Type', 'text/plain');
      res.statusCode = 200;
      res.end(`hello, ${reqbody}`);
    },
  },
] as MockMethod[];

```

API 与 mock 匹配

> 保存 api 的请求地址与请求类型与定义的 mock 接口一致即可

## 服务器交互

1.服务器的交互及跨域的配置参见项目配置插件 server

2.建议使用[YAPI](https://hellosean1025.github.io/yapi/)进行线上接口模拟，功能强大实用。
